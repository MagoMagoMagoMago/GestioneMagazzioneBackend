<div class="container py-2">

    <div class="row">
      <div class="col d-flex justify-content-center">
        <h1 class="display-5 text-white">Lista Acquisti</h1>
      </div>
    </div>
  
    <div class="row">
      <!-- IMPOSTAZIONI -->
      <div class="col d-flex align-items-center">
        <button class="btn btn-light shadow-none" role="button" data-bs-toggle="modal" data-bs-target="#configModal">
          <i class="bi bi-gear-wide-connected"></i> Impostazioni
        </button>
      </div>

  <!-- TABELLA -->
    <div class="table-responsive-xl pt-2">
      <table class="table table-light table-striped">
        <thead class="thead-dark table-warning header sticky-top">
          <tr>
            <ng-container *ngFor="let col of colPurchases">
              <th class="th" *ngIf="col.visible" (click)="changePurchasesBy(col)">
                {{ col.text }} <i class="bi bi-caret-down-square-fill" *ngIf="col.name === sort.name" [ngClass]="{'bi-caret-down-square-fill': sort.orderBy == true, 'bi-caret-up-square-fill': sort.orderBy == false}"></i></th>
            </ng-container>
            <th>
              Operazioni
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let purchase of listaPurchases">
            <td *ngIf="colPurchases[0].visible" class="align-middle" width=20%>{{purchase.number_invoice}}</td>
            <td *ngIf="colPurchases[1].visible" class="align-middle" width=20%>{{purchase.note}}</td>
            <td *ngIf="colPurchases[2].visible" class="align-middle" width=20% >{{purchase.date_invoice  | date: 'dd/MM/yyyy'}}</td>
            <td *ngIf="colPurchases[3].visible" class="align-middle" width=20%>{{purchase.supplier}}</td>
            <td class="align-middle" width=10%>
              <button type="button" class="btn btn-secondary btn-sm shadow-none" data-bs-toggle="modal" data-bs-target="#updatePurchase" (click)="onUpdateButtonClick(purchase)" style="margin: 2%;"><i class="bi bi-pencil-fill"></i></button>
              <button type="button" class="btn btn-danger btn-sm shadow-none" data-bs-toggle="modal" data-bs-target="#deletePurchase" (click)="openDeleteModal(purchase)"><i class="bi bi-trash"></i></button>
            </td>      
        </tr>
          <tr *ngIf="isListEmpty()">
            <td class="text-center align-middle not-found" colspan="100%">
              Nessun risultato trovato
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  
    <!-- PAGINATION  -->
    <nav aria-label="Page navigation example">
      <ul class="pagination justify-content-center">
        <li class="page-item" [ngClass]="{'disabled': page == 0}">
          <a class="page-link" (click)="changePage(page - 1)">Previous</a>
        </li>
  
        <ng-container *ngFor="let x of [].constructor(totalPages); let i = index">
          <li class="page-item" [ngClass]="{'active': i == page}" >
            <a class="page-link" (click)="changePage(i)">{{i + 1}}</a>
          </li>
        </ng-container>
        
        <li class="page-item" [ngClass]="{'disabled': page == totalPages - 1}">
          <a class="page-link" (click)="changePage(page + 1)">Next</a>
        </li>
      </ul>
    </nav>
  </div>
  
  <!-- CONFGIURATION MODAL -->
  <div class="modal fade" id="configModal" tabindex="-1" aria-labelledby="configModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Configura Tabella</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-sm">
              Articoli per pagina: 
            </div>
            <div class="col-sm">
              <select class="form-select shadow-lg" aria-label="Default select example" #purchasePerPage (change)="onChangePurchasePerPage(purchasePerPage.value)">  
                <option value="5">5</option>
                <option value="10">10</option>
                <option value="20">20</option>
              </select>
            </div>
          </div>
          <hr>
          <div class="row">
            <div class="col-sm">
              Colonne da visualizzare:
            </div>
            <div class="col-sm">
              <div class="form-check" *ngFor="let col of colPurchases">
                <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault" [checked]="col.visible"
                  (change)="changeVisibility(col)">
                <label class="form-check-label" for="flexCheckDefault">
                  {{col.text}}
                </label>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- DELETE MODAL -->
<div class="modal fade" id="deletePurchase" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Eliminazione</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Sei sicuro di voler eliminare l'acquisto '{{purchaseSelected.number_invoice}}'?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Chiudi</button>
        <button type="button" class="btn btn-danger" data-bs-dismiss="modal" (click)="deletePurchase(purchaseSelected.id)">Elimina</button>
      </div>
    </div>
  </div>
</div>

<!-- UPDATE MODAL -->
<div class="modal fade" id="updatePurchase" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Modifica Acquisto</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form [formGroup]="updateForm" (ngSubmit)="onSubmitUpdate()">
      <div class="modal-body">
        <div class="row">
          <div class=" col mb-2">
            <label for="number_invoice" class="col-form-label">Numero Acquisto:</label>
            <input type="text" class="form-control" id="number_invoice" formControlName="number_invoice" readonly>
          </div>
        </div>
        <div class="row">
          <div class="col mb-2">
            <label for="note" class="col-form-label">Descrizione:</label>
            <input type="text" class="form-control" id="note" formControlName="note">
          </div>
        </div>
          <div class="row">
            <div class="col mb-2">
              <div class="col mb-2">
                <label for="supplier" class="col-form-label">Fornitore:</label>
                <select class="form-select" aria-label="Default select example" formControlName="supplier">
                  <ng-container *ngFor="let supplier of suppliers">
                    <option value="{{supplier.id}}">{{supplier.name}}</option>
                  </ng-container>
                </select>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col mb-2">
              <label for="date_invoice" class="col-form-label">Data Acquisto:</label>
              <input class="form-control" id="date_invoice" formControlName="date_invoice" readonly>
            </div>
          </div>
        </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" #myModalClose data-bs-dismiss="modal">Chiudi</button>
        <button type="submit" class="btn btn-primary">Salva</button>
      </div>
    </form>
    </div>
  </div>
</div>