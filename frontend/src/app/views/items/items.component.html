<div class="container py-2">

  <div class="row">
    <div class="col d-flex justify-content-center">
      <h1 class="display-5 text-white">Lista Articoli</h1>
    </div>
  </div>

  <div class="row">

    <div class="col d-flex align-items-center">
      <button class="btn btn-light shadow-none" role="button" data-bs-toggle="modal" data-bs-target="#configModal">
        <i class="bi bi-gear-wide-connected"></i> Impostazioni Tabella
      </button>
    </div>

    <div class="col d-flex align-items-center justify-content-end">
      <button class="btn btn-success shadow-none">
        <i class="bi bi-plus-circle"></i> Nuovo
      </button>
    </div>

  </div>

  <div class="table-responsive-xl pt-2">
    <table class="table table-secondary table-striped">

      <thead class="thead-dark table-warning header sticky-top">
        <tr>
          <th class="image-column">
            Immagine
          </th>
          <ng-container *ngFor="let col of colItems">
            <th class="th" *ngIf="col.visible" (click)="changeOrderBy(col)">
              {{ col.text }} <i class="bi bi-caret-down-square-fill" *ngIf="col.name === sort.name" [ngClass]="{'bi-caret-down-square-fill': sort.orderBy == true, 'bi-caret-up-square-fill': sort.orderBy == false}"></i>
            </th>
          </ng-container>
          <th>
            Operazioni
          </th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let item of listaItems">
          <td class="image-column"><img src="{{item.image}}" class="img-thumbnail" alt="Articolo"></td>
          <td *ngIf="colItems[0].visible" class="align-middle" width=10%>{{item.asin}}</td>
          <td *ngIf="colItems[1].visible" class="align-middle" width=18%>{{item.title}}</td>
          <td *ngIf="colItems[2].visible" class="align-middle" width=30%>{{item.description}}</td>
          <td *ngIf="colItems[3].visible" class="align-middle" width=10%>{{item.category}}</td>
          <td *ngIf="colItems[4].visible" class="align-middle" width=10%>â‚¬ {{item.price | number : '1.2-2'}}</td>
          <td *ngIf="colItems[5].visible" class="align-middle font-weight-bold"
            [ngClass]="{'text-success': item.storage > item.minAvailability, 'text-danger': item.storage < item.minAvailability}">
            <i class="bi bi-exclamation-circle-fill" *ngIf="item.storage <= item.minAvailability"></i>
            <i class="bi bi-check-circle-fill" *ngIf="item.storage > item.minAvailability"></i>
             {{item.storage}}
          </td>
          <td *ngIf="colItems[6].visible" class="align-middle" width=10%>{{item.minAvailability}} pezzi</td>
          <td class="align-middle" width=10%>
            <button type="button" class="btn btn-secondary btn-sm shadow-none" data-bs-toggle="modal" data-bs-target="#updateItems" (click)="onUpdateButtonClick(item)"><i class="bi bi-pencil-fill"></i></button>
            <button type="button" class="btn btn-warning btn-sm shadow-none"><i class="bi bi-cart"></i></button>
            <button type="button" class="btn btn-danger btn-sm shadow-none" data-bs-toggle="modal" data-bs-target="#deleteItems" (click)="openDeleteModal(item)"><i class="bi bi-trash"></i></button>
          </td>
        </tr>
        <tr *ngIf="isListEmpty()">
          <td class="text-center align-middle not-found" colspan="100%">
            Nessun risultato trovato
          </td>
        </tr>
      </tbody>
      
    </table>
  </div>

  <nav aria-label="Page navigation example">
    <ul class="pagination justify-content-center">
      <li class="page-item" [ngClass]="{'disabled': page == 0}">
        <a class="page-link" (click)="changePage(page - 1)">Previous</a>
      </li>

      <ng-container *ngFor="let x of [].constructor(totalPages); let i = index">
        <li class="page-item" [ngClass]="{'active': i == page}" >
          <a class="page-link" (click)="changePage(i)">{{i + 1}}</a>
        </li>
      </ng-container>
      
      <li class="page-item" [ngClass]="{'disabled': page == totalPages - 1}">
        <a class="page-link" (click)="changePage(page + 1)">Next</a>
      </li>
    </ul>
  </nav>
</div>


<!-- CONFGIURATION MODAL -->
<div class="modal fade" id="configModal" tabindex="-1" aria-labelledby="configModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-sm">
            Articoli per pagina: 
          </div>
          <div class="col-sm">
            <select class="form-select shadow-lg" aria-label="Default select example" #itemPerPage (change)="onChangeItemPerPage(itemPerPage.value)">  
              <option value="5">5</option>
              <option value="10">10</option>
              <option value="20">20</option>
            </select>
          </div>
        </div>
        <hr>
        <div class="row">
          <div class="col-sm">
            Colonne da visualizzare:
          </div>
          <div class="col-sm">
            <div class="form-check" *ngFor="let col of colItems">
              <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault" [checked]="col.visible"
                (change)="changeVisibility(col)">
              <label class="form-check-label" for="flexCheckDefault">
                {{col.text}}
              </label>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- DELETE MODAL -->
<div class="modal fade" id="deleteItems" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Eliminazione</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Sei sicuro di voler eliminare l'articolo '{{itemSelected.title}}'?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Chiudi</button>
        <button type="button" class="btn btn-danger" data-bs-dismiss="modal" (click)="deleteItems(itemSelected.id)">Elimina</button>
      </div>
    </div>
  </div>
</div>

<!-- UPDATE MODAL -->
<div class="modal fade" id="updateItems" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Modifica Articolo</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form [formGroup]="updateForm" (ngSubmit)="onSubmitUpdate()">
      <div class="modal-body">
          <div class="row">
            <div class="col mb-2">
              <label for="asin" class="col-form-label">Asin:</label>
              <input type="text" class="form-control" id="asin" formControlName="asin">
            </div>
          </div>
          <div class="row">
            <div class=" col mb-2">
              <label for="title" class="col-form-label">Titolo:</label>
              <input type="text" class="form-control" id="title" formControlName="title">
            </div>
          </div>
          <div class="row">
            <div class="col mb-2">
              <label for="description" class="col-form-label">Descrizione:</label>
              <textarea class="form-control" id="description" formControlName="description"></textarea>
            </div>
          </div>
          <div class="row">
            <div class="col mb-2">
              <label for="categoria" class="col-form-label">Categoria:</label>
              <select class="form-select" aria-label="Default select example" formControlName="category">
                <option selected>Seleziona la categoria</option>
                <ng-container *ngFor="let category of categories">
                  <option value="{{category.id}}">{{category.name}}</option>
                </ng-container>
              </select>
            </div>
          </div>
          <div class="row">
            <div class="col mb-2">
              <label for="price" class="col-form-label">Prezzo:</label>
              <input type="number" class="form-control" id="price" formControlName="price">
            </div>
            <div class="col mb-2">
              <label for="storage" class="col-form-label">Giacenza:</label>
              <input type="text" class="form-control" id="storage" formControlName="storage">
            </div>
            <div class="col mb-2">
              <label for="minAvailability" class="col-form-label">Minimo:</label>
              <input type="text" class="form-control" id="minAvailability" formControlName="minAvailability">
            </div>
          </div>
          <div class="row">
            <div class="col mb-2">
              <label for="image" class="col-form-label">Immagine:</label>
              <input type="url" class="form-control" id="image" formControlName="image">
            </div>
          </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" #myModalClose data-bs-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary">Salva</button>
      </div>
      
    </form>
    </div>
  </div>
</div>
